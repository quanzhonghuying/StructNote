# StructNote アーキテクチャ設計書 v1.0

---

## 1. システム概要
StructNote は、ユーザーが入力または検索したテキストを  
**思考の可視化・構造化** に変換する知識加工支援ツールである。  

### 1.1 入力モード
1. **入力ボックスモード**  
   - 手動入力またはコピー＆ペーストでテキストを取り込む。  
2. **検索モード**  
   - NotebookLM などの知識源検索を UI 内で利用する。  
   - 将来的に Notion、Google Docs、社内Wiki なども追加可能。  
3. **右クリックモード**  
   - 任意ページで選択したテキストをブラウザ右クリックから StructNote に送信。  

### 1.2 出力機能
- マインドマップ生成  
- 業務フロー図生成  
- システム構成図生成  
- レポート書生成（Markdown → PDF/HTML）

---

## 2. システム構成図
```mermaid
graph TD
    User[ユーザー] --> FE[フロントエンド (React + Chrome Extension)]
    FE -->|入力/検索/右クリック| API[バックエンド API (FastAPI, Python)]
    API --> DB[(SQLite データベース)]
    API --> OpenAI[OpenAI API (GPT, Embeddings)]
    API --> Viz[可視化エンジン (Mermaid.js, diagrams)]
    FE --> Render[ブラウザ描画 (Mermaid.js)]

---

## 3. 技術スタック選定理由

### 3.1 フロントエンド
- **React + TypeScript + Chrome Extension (Manifest V3)**  
  → ユーザー UI を柔軟に構築でき、ブラウザ統合が容易。  

### 3.2 バックエンド
- **Python + FastAPI**  
  → 軽量で高速な API サーバを実装可能、AI API と親和性が高い。  

### 3.3 データベース
- **SQLite (MVP) → 将来的に PostgreSQL**  
  → ローカル保存と軽量データ管理に適している。  

### 3.4 可視化
- **Mermaid.js**  
  → ブラウザ側で即座に描画可能。  
- **diagrams ライブラリ**  
  → 高度なシステム構成図生成に対応可能。  

### 3.5 AI サービス
- **OpenAI API（GPT, Embeddings）**  
  → テキスト解析・要約・構造化に利用。  

---

## 4. モジュール構成

### 4.1 フロントエンド
- **入力モジュール**  
  - 入力ボックス、検索ボックス、右クリック連携を提供。  
- **UI コントローラ**  
  - ユーザー操作をバックエンド API に送信。  
- **描画ビュー**  
  - Mermaid.js による図表表示。  
- **エクスポート機能**  
  - PDF/HTML 出力を提供。  

### 4.2 バックエンド
- **API Gateway**  
  - リクエスト受付、認証処理を行う。  

- **Input Processor**  
  - 入力テキストの解析処理を行う。  

- **Input Data Manager**  
  - ユーザーが入力または検索したテキストを保存する。  
  - 保存したデータを再利用し、レポート / マインドマップ / フロー図 / 構成図を生成可能にする。  
  - SQLite に保存し、将来的に検索・再利用機能を拡張可能。  

- **Visualization Generator**  
  - フロー図 / マインドマップ / 構成図を生成する。  

- **Report Generator**  
  - Markdown 形式でレポートを生成し、PDF/HTML に変換する。  

- **Data Manager**  
  - ユーザー設定・知識源リスト・可視化結果を永続化する。  

---

## 5. データフロー
1. ユーザーがテキストを入力 / 検索 / 右クリックで送信する。  
2. フロントエンドがバックエンド API にリクエストを送信する。  
3. バックエンドの **Input Processor** が入力テキストを解析する。  
4. 解析結果と同時に、**Input Data Manager** が入力テキストを保存する。  
   - SQLite に保存され、後で再利用可能になる。  
5. 必要に応じて OpenAI API を呼び出し、テキストを要約・構造化する。  
6. 可視化エンジンが Mermaid.js / diagrams のコードを生成する。  
7. バックエンドが生成結果をフロントエンドに返却する。  
8. フロントエンドが結果を描画ビューで表示する。  
9. 必要に応じて **Report Generator** が Markdown → PDF/HTML に変換し、ユーザーに提供する。 

---

## 6. セキュリティ設計
- **データ保存**  
  - SQLite に暗号化保存（ユーザー専用）。  
- **API キー管理**  
  - `.env` ファイルで管理し、リポジトリには含めない。  
- **リポジトリ管理**  
  - GitHub プライベートリポジトリを利用。  

---

## 7. 将来拡張
- **v1.1**  
  - 右クリックメニュー連携  
  - マインドマップ生成  
  - レポート書生成  
- **v1.2**  
  - システム構成図生成  
  - 知識源リストのカスタマイズ  
- **v2.0**  
  - 多言語入力対応  
  - 音声/画像入力  
  - チーム共有機能  

